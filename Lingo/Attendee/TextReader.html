<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Lingo::Attendee::TextReader - lingo Application documentation (v1.8.5)</title>

<link href="../../fonts.css" rel="stylesheet">
<link href="../../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
</script>

<script src="../../js/jquery.js"></script>
<script src="../../js/navigation.js"></script>
<script src="../../js/search_index.js"></script>
<script src="../../js/search.js"></script>
<script src="../../js/searcher.js"></script>
<script src="../../js/darkfish.js"></script>


<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  
<div class="nav-section">
  <h3>Table of Contents</h3>

  <ul class="link-list" role="directory">
    <li><a href="#class-Lingo::Attendee::TextReader-label-M%C3%B6gliche+Verlinkung">Mögliche Verlinkung</a>
    <li><a href="#class-Lingo::Attendee::TextReader-label-Parameter">Parameter</a>
    <li><a href="#class-Lingo::Attendee::TextReader-label-Generierte+Kommandos">Generierte Kommandos</a>
    <li><a href="#class-Lingo::Attendee::TextReader-label-Beispiele">Beispiele</a>
  </ul>
</div>


  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link">self
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-i-add_files">#add_files</a>
    
    <li ><a href="#method-i-cancel">#cancel</a>
    
    <li ><a href="#method-i-cancel_filter">#cancel_filter</a>
    
    <li ><a href="#method-i-control">#control</a>
    
    <li ><a href="#method-i-file_type">#file_type</a>
    
    <li ><a href="#method-i-filter">#filter</a>
    
    <li ><a href="#method-i-filter_html">#filter_html</a>
    
    <li ><a href="#method-i-filter_pdf">#filter_pdf</a>
    
    <li ><a href="#method-i-filter_pdftotext">#filter_pdftotext</a>
    
    <li ><a href="#method-i-get_files">#get_files</a>
    
    <li ><a href="#method-i-init">#init</a>
    
    <li ><a href="#method-i-open_file">#open_file</a>
    
    <li ><a href="#method-i-spool">#spool</a>
    
    <li ><a href="#method-i-stdin-3F">#stdin?</a>
    
    <li ><a href="#method-i-string_or_io">#string_or_io</a>
    
    <li ><a href="#method-i-with_tempfile">#with_tempfile</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Lingo::Attendee::TextReader">
  <h1 id="class-Lingo::Attendee::TextReader" class="class">
    class Lingo::Attendee::TextReader
  </h1>

  <section class="description">
    
<p>Der <a href="TextReader.html">TextReader</a> ist eine klassische
Datenquelle. Er liest eine oder mehrere Dateien und gibt sie Zeilenweise in
den Ausgabekanal. Der Start bzw. Wechsel einer Datei wird dabei über den
Kommandokanal angekündigt, ebenso wie das Ende.</p>

<p>Der <a href="TextReader.html">TextReader</a> kann ebenfalls ein spezielles
Dateiformat verarbeiten, welches zum Austausch mit dem LIR-System dient.
Dabei enthält die Datei Record-basierte Informationen, die wie mehrere
Dateien verarbeitet werden.</p>

<h3 id="class-Lingo::Attendee::TextReader-label-M%C3%B6gliche+Verlinkung">Mögliche Verlinkung<span><a href="#class-Lingo::Attendee::TextReader-label-M%C3%B6gliche+Verlinkung">&para;</a> <a href="#documentation">&uarr;</a></span></h3>
<dl class="rdoc-list note-list"><dt>Erzeugt
<dd>
<p>Daten des Typs <strong>String</strong> (Textzeile) z.B. für <a
href="Tokenizer.html">Tokenizer</a>, Textwriter</p>
</dd></dl>

<h3 id="class-Lingo::Attendee::TextReader-label-Parameter">Parameter<span><a href="#class-Lingo::Attendee::TextReader-label-Parameter">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>Kursiv dargestellte Parameter sind optional (ggf. mit Angabe der
Voreinstellung). Alle anderen Parameter müssen zwingend angegeben werden.</p>
<dl class="rdoc-list note-list"><dt><strong>out</strong>
<dd>
<p>siehe allgemeine Beschreibung des <a href="../Attendee.html">Attendee</a></p>
</dd><dt><strong>files</strong>
<dd>
<p>Es können eine oder mehrere Dateien angegeben werden, die nacheinander
eingelesen und zeilenweise weitergeleitet werden. Die Dateien werden mit
Komma voneinander getrennt, z.B.</p>

<pre>files: &#39;readme.txt&#39;
files: &#39;readme.txt,lingo.cfg&#39;</pre>
</dd><dt><strong><em>records</em></strong>
<dd>
<p>Mit diesem Parameter wird angegeben, woran der Anfang eines neuen Records
erkannt werden kann und wie die Record-Nummer identifiziert wird. Das
Format einer LIR-Datei ist z.B.</p>

<pre>[00001.]
020: ¬Die Aufgabenteilung zwischen Wortschatz und Grammatik.

[00002.]
020: Nicht-konventionelle Thesaurusrelationen als Orientierungshilfen.</pre>

<p>Mit der Angabe von</p>

<pre>records: &quot;^\[(\d+)\.\]&quot;</pre>

<p>werden die Record-Zeilen erkannt und jeweils die Record-Nummer
<code>00001</code>, bzw. <code>00002</code> erkannt.</p>
</dd></dl>

<h3 id="class-Lingo::Attendee::TextReader-label-Generierte+Kommandos">Generierte Kommandos<span><a href="#class-Lingo::Attendee::TextReader-label-Generierte+Kommandos">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>Damit der nachfolgende Datenstrom einwandfrei verarbeitet werden kann,
generiert der <a href="TextReader.html">TextReader</a> Kommandos, die mit
in den Datenstrom eingefügt werden.</p>
<dl class="rdoc-list note-list"><dt><strong>*FILE(&lt;dateiname&gt;)</strong>
<dd>
<p>Kennzeichnet den Beginn der Datei &lt;dateiname&gt;</p>
</dd><dt><strong>*EOF(&lt;dateiname&gt;)</strong>
<dd>
<p>Kennzeichnet das Ende der Datei &lt;dateiname&gt;</p>
</dd><dt><strong>*LIR_FORMAT(&#39;&#39;)</strong>
<dd>
<p>Kennzeichnet die Verarbeitung einer Datei im LIR-Format (nur bei
LIR-Format).</p>
</dd><dt><strong>*RECORD(&lt;nummer&gt;)</strong>
<dd>
<p>Kennzeichnet den Beginn eines neuen Records (nur bei LIR-Format).</p>
</dd></dl>

<h3 id="class-Lingo::Attendee::TextReader-label-Beispiele">Beispiele<span><a href="#class-Lingo::Attendee::TextReader-label-Beispiele">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>Bei der Verarbeitung einer normalen Textdatei mit der Ablaufkonfiguration
<code>t1.cfg</code></p>

<pre>meeting:
  attendees:
    - text_reader: { out: lines, files: &#39;$(files)&#39; }
    - debugger:    { in: lines, prompt: &#39;out&gt;&#39; }</pre>

<p>ergibt die Ausgabe über den Debugger: <code>lingo -c t1 test.txt</code></p>

<pre>out&gt; *FILE(&#39;test.txt&#39;)
out&gt; &quot;Dies ist eine Zeile.&quot;
out&gt; &quot;Dies ist noch eine.&quot;
out&gt; *EOF(&#39;test.txt&#39;)</pre>

<p>Bei der Verarbeitung einer LIR-Datei mit der Ablaufkonfiguration
<code>t2.cfg</code></p>

<pre>meeting:
  attendees:
    - text_reader: { out: lines,  files: &#39;$(files)&#39;, records: &quot;^\[(\d+)\.\]&quot; }
    - debugger:    { in: lines, prompt: &#39;out&gt;&#39;}</pre>

<p>ergibt die Ausgabe mit <code>lingo -c t2 lir.txt</code></p>

<pre>out&gt; *LIR-FORMAT(&#39;&#39;)
out&gt; *FILE(&#39;lir.txt&#39;)
out&gt; *RECORD(&#39;00001&#39;)
out&gt; &quot;020: \254Die Aufgabenteilung zwischen Wortschatz und Grammatik.&quot;
out&gt; *RECORD(&#39;00002&#39;)
out&gt; &quot;020: Nicht-konventionelle Thesaurusrelationen als Orientierungshilfen.&quot;
out&gt; *EOF(&#39;lir.txt&#39;)</pre>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="protected-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Protected Instance Methods</h3>
       </header>

    
      <div id="method-i-control" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">control</span><span
            class="method-args">(cmd, param)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="control-source">
            <pre><span class="ruby-comment"># File lib/lingo/attendee/text_reader.rb, line 124</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">control</span>(<span class="ruby-identifier">cmd</span>, <span class="ruby-identifier">param</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">cmd</span> <span class="ruby-operator">==</span> <span class="ruby-constant">STR_CMD_TALK</span>
    <span class="ruby-identifier">forward</span>(<span class="ruby-constant">STR_CMD_LIR</span>, <span class="ruby-string">&#39;&#39;</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@lir</span>
    <span class="ruby-ivar">@files</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">spool</span>(<span class="ruby-identifier">i</span>) }
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-init" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">init</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>TODO: FILE und LIR-FILE (?)</p>
          
          

          
          <div class="method-source-code" id="init-source">
            <pre><span class="ruby-comment"># File lib/lingo/attendee/text_reader.rb, line 110</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">init</span>
  <span class="ruby-identifier">get_files</span>

  <span class="ruby-ivar">@chomp</span>    = <span class="ruby-identifier">get_key</span>(<span class="ruby-string">&#39;chomp&#39;</span>, <span class="ruby-keyword">true</span>)
  <span class="ruby-ivar">@filter</span>   = <span class="ruby-identifier">get_key</span>(<span class="ruby-string">&#39;filter&#39;</span>, <span class="ruby-keyword">false</span>)
  <span class="ruby-ivar">@progress</span> = <span class="ruby-identifier">get_key</span>(<span class="ruby-string">&#39;progress&#39;</span>, <span class="ruby-keyword">false</span>)

  <span class="ruby-identifier">lingo</span>.<span class="ruby-identifier">deprecate</span>(<span class="ruby-string">&#39;lir-record-pattern&#39;</span>, <span class="ruby-value">:records</span>, <span class="ruby-keyword">self</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">has_key?</span>(<span class="ruby-string">&#39;lir-record-pattern&#39;</span>)

  <span class="ruby-ivar">@lir</span>  = <span class="ruby-identifier">get_re</span>(<span class="ruby-string">&#39;records&#39;</span>, <span class="ruby-identifier">get_key</span>(<span class="ruby-string">&#39;lir-record-pattern&#39;</span>, <span class="ruby-keyword">nil</span>), <span class="ruby-regexp">%r{^\[(\d+)\.\]}</span>)  <span class="ruby-comment"># DEPRECATE lir-record-pattern</span>
  <span class="ruby-ivar">@cut</span>  = <span class="ruby-identifier">get_re</span>(<span class="ruby-string">&#39;fields&#39;</span>, <span class="ruby-operator">!</span><span class="ruby-operator">!</span><span class="ruby-ivar">@lir</span>, <span class="ruby-regexp">%r{^.+?:\s*}</span>)
  <span class="ruby-ivar">@skip</span> = <span class="ruby-identifier">get_re</span>(<span class="ruby-string">&#39;skip&#39;</span>, <span class="ruby-keyword">nil</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="private-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Private Instance Methods</h3>
       </header>

    
      <div id="method-i-add_files" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">add_files</span><span
            class="method-args">(path, glob, recursive = false)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="add_files-source">
            <pre><span class="ruby-comment"># File lib/lingo/attendee/text_reader.rb, line 270</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">add_files</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">glob</span>, <span class="ruby-identifier">recursive</span> = <span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">entries</span> = <span class="ruby-constant">Dir</span>[<span class="ruby-identifier">path</span>].<span class="ruby-identifier">sort!</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">FileNotFoundError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">path</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">entries</span>.<span class="ruby-identifier">empty?</span>

  <span class="ruby-identifier">entries</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">entry</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span>(<span class="ruby-identifier">entry</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">recursive</span>
        <span class="ruby-constant">Find</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">entry</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">match</span><span class="ruby-operator">|</span>
          <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">file?</span>(<span class="ruby-identifier">match</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">fnmatch?</span>(<span class="ruby-identifier">glob</span>, <span class="ruby-identifier">match</span>)
            <span class="ruby-ivar">@files</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">match</span>
          <span class="ruby-keyword">end</span>
        }
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">add_files</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">entry</span>, <span class="ruby-identifier">glob</span>), <span class="ruby-identifier">glob</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@files</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">entry</span>
    <span class="ruby-keyword">end</span>
  }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-cancel" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">cancel</span><span
            class="method-args">(msg)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="cancel-source">
            <pre><span class="ruby-comment"># File lib/lingo/attendee/text_reader.rb, line 228</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">cancel</span>(<span class="ruby-identifier">msg</span>)
  <span class="ruby-identifier">throw</span>(<span class="ruby-value">:cancel</span>, <span class="ruby-identifier">msg</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-cancel_filter" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">cancel_filter</span><span
            class="method-args">(type, name, what = :gem)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="cancel_filter-source">
            <pre><span class="ruby-comment"># File lib/lingo/attendee/text_reader.rb, line 224</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">cancel_filter</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">what</span> = <span class="ruby-value">:gem</span>)
  <span class="ruby-identifier">cancel</span>(<span class="ruby-node">&quot;#{type} filter not available. Please install the `#{name}&#39; #{what}.&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-file_type" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">file_type</span><span
            class="method-args">(io, path)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="file_type-source">
            <pre><span class="ruby-comment"># File lib/lingo/attendee/text_reader.rb, line 208</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">file_type</span>(<span class="ruby-identifier">io</span>, <span class="ruby-identifier">path</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-constant">Object</span>.<span class="ruby-identifier">const_defined?</span>(<span class="ruby-value">:FileMagic</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">io</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:rewind</span>)
    <span class="ruby-identifier">type</span> = <span class="ruby-constant">FileMagic</span>.<span class="ruby-identifier">fm</span>(<span class="ruby-value">:mime</span>, <span class="ruby-identifier">simplified</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>).<span class="ruby-identifier">buffer</span>(<span class="ruby-identifier">io</span>.<span class="ruby-identifier">read</span>(<span class="ruby-value">256</span>))
    <span class="ruby-identifier">io</span>.<span class="ruby-identifier">rewind</span>
    <span class="ruby-identifier">type</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-constant">Object</span>.<span class="ruby-identifier">const_defined?</span>(<span class="ruby-value">:MIME</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">MIME</span>.<span class="ruby-identifier">const_defined?</span>(<span class="ruby-value">:Types</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span> = <span class="ruby-constant">MIME</span><span class="ruby-operator">::</span><span class="ruby-constant">Types</span>.<span class="ruby-identifier">of</span>(<span class="ruby-identifier">path</span>).<span class="ruby-identifier">first</span>
      <span class="ruby-identifier">type</span>.<span class="ruby-identifier">content_type</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">cancel</span>(<span class="ruby-string">&#39;Filters not available. File type could not be determined.&#39;</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">cancel</span>(<span class="ruby-string">&quot;Filters not available. Please install the `ruby-filemagic&#39; or `mime-types&#39; gem.&quot;</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-filter" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">filter</span><span
            class="method-args">(io, path, progress) { |line, pos| ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="filter-source">
            <pre><span class="ruby-comment"># File lib/lingo/attendee/text_reader.rb, line 159</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">filter</span>(<span class="ruby-identifier">io</span>, <span class="ruby-identifier">path</span>, <span class="ruby-identifier">progress</span>)
  <span class="ruby-identifier">block</span> = <span class="ruby-ivar">@progress</span> <span class="ruby-operator">?</span>
    <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span> <span class="ruby-keyword">yield</span> <span class="ruby-identifier">line</span>, <span class="ruby-identifier">io</span>.<span class="ruby-identifier">pos</span> } <span class="ruby-operator">:</span>
    <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span> <span class="ruby-keyword">yield</span> <span class="ruby-identifier">line</span>, <span class="ruby-value">0</span> }

  <span class="ruby-identifier">io</span> = <span class="ruby-keyword">case</span> <span class="ruby-ivar">@filter</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">file_type</span>(<span class="ruby-identifier">io</span>, <span class="ruby-identifier">path</span>) <span class="ruby-operator">:</span> <span class="ruby-ivar">@filter</span>.<span class="ruby-identifier">to_s</span>
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;pdftotext&#39;</span> <span class="ruby-keyword">then</span> <span class="ruby-identifier">filter_pdftotext</span>(<span class="ruby-identifier">io</span>, <span class="ruby-identifier">path</span>, <span class="ruby-identifier">progress</span>)
    <span class="ruby-keyword">when</span> <span class="ruby-regexp">/html/i</span>     <span class="ruby-keyword">then</span> <span class="ruby-identifier">filter_html</span>(<span class="ruby-identifier">io</span>)
    <span class="ruby-keyword">when</span> <span class="ruby-regexp">/xml/i</span>      <span class="ruby-keyword">then</span> <span class="ruby-identifier">filter_html</span>(<span class="ruby-identifier">io</span>, <span class="ruby-keyword">true</span>)
    <span class="ruby-keyword">when</span> <span class="ruby-regexp">/pdf/i</span>      <span class="ruby-keyword">then</span> <span class="ruby-identifier">filter_pdf</span>(<span class="ruby-identifier">io</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>); <span class="ruby-keyword">return</span>
    <span class="ruby-keyword">else</span> <span class="ruby-identifier">io</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">io</span>.<span class="ruby-identifier">each_line</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-filter_html" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">filter_html</span><span
            class="method-args">(io, xml = false)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="filter_html-source">
            <pre><span class="ruby-comment"># File lib/lingo/attendee/text_reader.rb, line 197</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">filter_html</span>(<span class="ruby-identifier">io</span>, <span class="ruby-identifier">xml</span> = <span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">type</span> = <span class="ruby-identifier">xml</span> <span class="ruby-operator">?</span> <span class="ruby-value">:XML</span> <span class="ruby-operator">:</span> <span class="ruby-value">:HTML</span>

  <span class="ruby-keyword">if</span> <span class="ruby-constant">Object</span>.<span class="ruby-identifier">const_defined?</span>(<span class="ruby-value">:Nokogiri</span>)
    <span class="ruby-identifier">doc</span> = <span class="ruby-constant">Nokogiri</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">io</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-constant">ENC</span>)
    <span class="ruby-identifier">string_or_io</span>(<span class="ruby-identifier">doc</span>.<span class="ruby-identifier">children</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">inner_text</span> }.<span class="ruby-identifier">join</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">cancel_filter</span>(<span class="ruby-identifier">type</span>, <span class="ruby-value">:nokogiri</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-filter_pdf" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">filter_pdf</span><span
            class="method-args">(io) { |text| ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="filter_pdf-source">
            <pre><span class="ruby-comment"># File lib/lingo/attendee/text_reader.rb, line 189</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">filter_pdf</span>(<span class="ruby-identifier">io</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-constant">Object</span>.<span class="ruby-identifier">const_defined?</span>(<span class="ruby-value">:PDF</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">PDF</span>.<span class="ruby-identifier">const_defined?</span>(<span class="ruby-value">:Reader</span>)
    <span class="ruby-constant">PDF</span><span class="ruby-operator">::</span><span class="ruby-constant">Reader</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">io</span>).<span class="ruby-identifier">pages</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span> <span class="ruby-keyword">yield</span> <span class="ruby-identifier">page</span>.<span class="ruby-identifier">text</span> }
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">cancel_filter</span>(<span class="ruby-value">:PDF</span>, <span class="ruby-string">&#39;pdf-reader&#39;</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-filter_pdftotext" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">filter_pdftotext</span><span
            class="method-args">(io, path, progress)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="filter_pdftotext-source">
            <pre><span class="ruby-comment"># File lib/lingo/attendee/text_reader.rb, line 175</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">filter_pdftotext</span>(<span class="ruby-identifier">io</span>, <span class="ruby-identifier">path</span>, <span class="ruby-identifier">progress</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">cmd</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">which</span>(<span class="ruby-identifier">name</span> = <span class="ruby-string">&#39;pdftotext&#39;</span>)
    <span class="ruby-identifier">with_tempfile</span>(<span class="ruby-identifier">name</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">tempfile</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">pdf_path</span> = <span class="ruby-identifier">stdin?</span>(<span class="ruby-identifier">path</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">tempfile</span>[<span class="ruby-value">:pdf</span>, <span class="ruby-identifier">io</span>] <span class="ruby-operator">:</span> <span class="ruby-identifier">path</span>
      <span class="ruby-identifier">system</span>(<span class="ruby-identifier">cmd</span>, <span class="ruby-string">&#39;-q&#39;</span>, <span class="ruby-identifier">pdf_path</span>, <span class="ruby-identifier">txt_path</span> = <span class="ruby-identifier">tempfile</span>[<span class="ruby-value">:txt</span>])

      <span class="ruby-identifier">progress</span>.<span class="ruby-identifier">init</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">size</span>(<span class="ruby-identifier">txt_path</span>)) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@progress</span>
      <span class="ruby-identifier">open_file</span>(<span class="ruby-identifier">txt_path</span>)
    }
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">cancel_filter</span>(<span class="ruby-value">:PDF</span>, <span class="ruby-identifier">name</span>, <span class="ruby-value">:command</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_files" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_files</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="get_files-source">
            <pre><span class="ruby-comment"># File lib/lingo/attendee/text_reader.rb, line 259</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_files</span>
  <span class="ruby-identifier">args</span> = [<span class="ruby-identifier">get_key</span>(<span class="ruby-string">&#39;glob&#39;</span>, <span class="ruby-string">&#39;*.txt&#39;</span>), <span class="ruby-identifier">get_key</span>(<span class="ruby-string">&#39;recursive&#39;</span>, <span class="ruby-keyword">false</span>)]

  <span class="ruby-ivar">@files</span> = []

  <span class="ruby-constant">Array</span>(<span class="ruby-identifier">get_key</span>(<span class="ruby-string">&#39;files&#39;</span>, <span class="ruby-string">&#39;-&#39;</span>)).<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">stdin?</span>(<span class="ruby-identifier">path</span>) <span class="ruby-operator">?</span> <span class="ruby-ivar">@files</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">path</span> <span class="ruby-operator">:</span>
      <span class="ruby-identifier">add_files</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">path</span>), <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
  }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-open_file" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">open_file</span><span
            class="method-args">(path)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="open_file-source">
            <pre><span class="ruby-comment"># File lib/lingo/attendee/text_reader.rb, line 240</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">open_file</span>(<span class="ruby-identifier">path</span>)
  <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">path</span>, <span class="ruby-string">&#39;rb&#39;</span>, <span class="ruby-identifier">encoding</span><span class="ruby-operator">:</span> <span class="ruby-constant">ENC</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-spool" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">spool</span><span
            class="method-args">(path)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Gibt eine Datei zeilenweise in den Ausgabekanal</p>
          
          

          
          <div class="method-source-code" id="spool-source">
            <pre><span class="ruby-comment"># File lib/lingo/attendee/text_reader.rb, line 134</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">spool</span>(<span class="ruby-identifier">path</span>)
  <span class="ruby-identifier">forward</span>(<span class="ruby-constant">STR_CMD_FILE</span>, <span class="ruby-identifier">path</span>)

  <span class="ruby-identifier">io</span> = <span class="ruby-operator">!</span><span class="ruby-identifier">stdin?</span>(<span class="ruby-identifier">path</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">open_file</span>(<span class="ruby-identifier">name</span> = <span class="ruby-identifier">path</span>) <span class="ruby-operator">:</span>
    <span class="ruby-identifier">string_or_io</span>(<span class="ruby-identifier">lingo</span>.<span class="ruby-identifier">config</span>.<span class="ruby-identifier">stdin</span>.<span class="ruby-identifier">set_encoding</span>(<span class="ruby-constant">ENC</span>))

  <span class="ruby-constant">Progress</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">self</span>, <span class="ruby-ivar">@progress</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">io</span>.<span class="ruby-identifier">size</span>, <span class="ruby-identifier">name</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">progress</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">filter</span>(<span class="ruby-identifier">io</span>, <span class="ruby-identifier">path</span>, <span class="ruby-identifier">progress</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">line</span>, <span class="ruby-identifier">pos</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">progress</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">pos</span>

      <span class="ruby-identifier">line</span>.<span class="ruby-identifier">chomp!</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@chomp</span>
      <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-ivar">@skip</span>

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-ivar">@lir</span>
        <span class="ruby-identifier">forward</span>(<span class="ruby-constant">STR_CMD_RECORD</span>, <span class="ruby-node">$1</span> <span class="ruby-operator">||</span> <span class="ruby-node">$&amp;</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">line</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-ivar">@cut</span>, <span class="ruby-string">&#39;&#39;</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@cut</span>
        <span class="ruby-identifier">forward</span>(<span class="ruby-identifier">line</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">line</span>.<span class="ruby-identifier">empty?</span>
      <span class="ruby-keyword">end</span>
    }
  }

  <span class="ruby-identifier">forward</span>(<span class="ruby-constant">STR_CMD_EOF</span>, <span class="ruby-identifier">path</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-stdin-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">stdin?</span><span
            class="method-args">(path)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="stdin-3F-source">
            <pre><span class="ruby-comment"># File lib/lingo/attendee/text_reader.rb, line 232</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">stdin?</span>(<span class="ruby-identifier">path</span>)
  <span class="ruby-node">%w[STDIN -]</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">path</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-string_or_io" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">string_or_io</span><span
            class="method-args">(io)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="string_or_io-source">
            <pre><span class="ruby-comment"># File lib/lingo/attendee/text_reader.rb, line 236</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">string_or_io</span>(<span class="ruby-identifier">io</span>)
  <span class="ruby-ivar">@progress</span> <span class="ruby-operator">?</span> <span class="ruby-constant">StringIO</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">io</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">io</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">io</span>.<span class="ruby-identifier">read</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">io</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-with_tempfile" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">with_tempfile</span><span
            class="method-args">(name) { |lambda| ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="with_tempfile-source">
            <pre><span class="ruby-comment"># File lib/lingo/attendee/text_reader.rb, line 244</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">with_tempfile</span>(<span class="ruby-identifier">name</span>)
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;tempfile&#39;</span>

  <span class="ruby-identifier">tempfiles</span> = []

  <span class="ruby-keyword">yield</span> <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">ext</span>, <span class="ruby-identifier">io</span> = <span class="ruby-keyword">nil</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">tempfiles</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">temp</span> = <span class="ruby-constant">Tempfile</span>.<span class="ruby-identifier">new</span>([<span class="ruby-identifier">name</span>, <span class="ruby-node">&quot;.#{ext}&quot;</span>])
    <span class="ruby-identifier">temp</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">io</span>.<span class="ruby-identifier">read</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">io</span>
    <span class="ruby-identifier">temp</span>.<span class="ruby-identifier">close</span>
    <span class="ruby-identifier">temp</span>.<span class="ruby-identifier">path</span>
  }
<span class="ruby-keyword">ensure</span>
  <span class="ruby-identifier">tempfiles</span>.<span class="ruby-identifier">each</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:unlink</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://rdoc.rubyforge.org">RDoc</a> 4.1.2.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

